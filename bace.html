<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>3D Solar System Mobile</title>
    <style>
        body { margin: 0; background-color: #000; overflow: hidden; font-family: sans-serif; touch-action: none; }
        canvas { display: block; }
        #ui {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 12px 20px;
            border-radius: 25px;
            pointer-events: none;
            font-size: 14px;
            text-align: center;
            width: 80%;
            max-width: 300px;
        }
    </style>
</head>
<body>

<div id="ui">
    左右スワイプ：時間を操作<br>
    指2本で拡大・回転
</div>

<script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
</script>

<script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    // --- 基本設定 ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio); // スマホの高解像度に対応
    document.body.appendChild(renderer.domElement);

    let virtualTime = 0;
    let isTouching = false;
    let lastTouchX = 0;

    // --- ライト ---
    const sunLight = new THREE.PointLight(0xffffff, 5, 1000, 0);
    scene.add(sunLight);
    const ambientLight = new THREE.AmbientLight(0x404040, 1.0);
    scene.add(ambientLight);

    // --- 惑星データ ---
    const planetData = [
        { name: "水星", color: 0xA5A5A5, distance: 40,  size: 1.5, period: 0.24 },
        { name: "金星", color: 0xE3BB76, distance: 60,  size: 2.5, period: 0.61 },
        { name: "地球", color: 0x2271B3, distance: 85,  size: 2.8, period: 1.0 },
        { name: "火星", color: 0xE27B58, distance: 110, size: 2.0, period: 1.88 },
        { name: "木星", color: 0xD39C7E, distance: 160, size: 7.0, period: 11.86 },
        { name: "土星", color: 0xC5AB6E, distance: 210, size: 6.0, period: 29.46 },
        { name: "天王星", color: 0xBBE1E4, distance: 260, size: 4.0, period: 84.01 },
        { name: "海王星", color: 0x6081FF, distance: 310, size: 4.0, period: 164.8 }
    ];

    // 太陽
    const sun = new THREE.Mesh(
        new THREE.SphereGeometry(15, 32, 32),
        new THREE.MeshBasicMaterial({ color: 0xFFCC00 })
    );
    scene.add(sun);

    const planets = [];
    planetData.forEach(data => {
        // 軌道
        const orbit = new THREE.Mesh(
            new THREE.RingGeometry(data.distance - 0.3, data.distance + 0.3, 128),
            new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide, transparent: true, opacity: 0.15 })
        );
        orbit.rotation.x = Math.PI / 2;
        scene.add(orbit);

        // 惑星
        const group = new THREE.Group();
        const mesh = new THREE.Mesh(
            new THREE.SphereGeometry(data.size, 32, 32),
            new THREE.MeshStandardMaterial({ color: data.color })
        );
        mesh.position.x = data.distance;
        group.add(mesh);
        scene.add(group);
        planets.push({ group, period: data.period });
    });

    // 背景の星
    const starGeo = new THREE.BufferGeometry();
    const starCoords = [];
    for(let i=0; i<3000; i++) starCoords.push((Math.random()-0.5)*1500, (Math.random()-0.5)*1500, (Math.random()-0.5)*1500);
    starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starCoords, 3));
    scene.add(new THREE.Points(starGeo, new THREE.PointsMaterial({ size: 1, color: 0xffffff })));

    camera.position.set(0, 200, 400);

    // --- カメラ操作 (OrbitControls) ---
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true; // 滑らかな動き
    controls.dampingFactor = 0.05;

    // --- タッチイベント（時間操作用） ---
    renderer.domElement.addEventListener('touchstart', (e) => {
        if (e.touches.length === 1) { // 指1本の場合のみ時間操作
            isTouching = true;
            lastTouchX = e.touches[0].clientX;
        }
    }, { passive: false });

    renderer.domElement.addEventListener('touchmove', (e) => {
        if (isTouching && e.touches.length === 1) {
            const deltaX = e.touches[0].clientX - lastTouchX;
            virtualTime += deltaX * 0.01; // スワイプで時間を動かす
            lastTouchX = e.touches[0].clientX;
        }
    }, { passive: false });

    renderer.domElement.addEventListener('touchend', () => isTouching = false);

    // マウスドラッグでも動くように維持
    window.addEventListener('mousedown', (e) => { if(e.button === 0) { isTouching = true; lastTouchX = e.clientX; }});
    window.addEventListener('mousemove', (e) => { if(isTouching) { virtualTime += (e.clientX - lastTouchX) * 0.01; lastTouchX = e.clientX; }});
    window.addEventListener('mouseup', () => isTouching = false);

    // --- アニメーションループ ---
    function animate() {
        requestAnimationFrame(animate);
        
        if (!isTouching) {
            virtualTime += 0.005; // 自動進行
        }

        planets.forEach(p => {
            p.group.rotation.y = virtualTime / p.period;
        });

        controls.update();
        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    animate();
</script>
</body>
</html>
